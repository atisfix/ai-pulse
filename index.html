<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a0f">
<title>AI Pulse</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>%E2%9A%A1</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Newsreader:opsz,wght@6..72,300;6..72,400;6..72,500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  html{-webkit-text-size-adjust:100%;scroll-behavior:smooth}
  body{font-family:'DM Sans','SF Pro Display','Helvetica Neue',-apple-system,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overflow-x:hidden;overscroll-behavior-y:none}
  ::-webkit-scrollbar{width:0;height:0}
  #root{min-height:100vh;min-height:100dvh}
  @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  @keyframes pulse{0%,100%{opacity:.5}50%{opacity:1}}
  @keyframes spin{to{transform:rotate(360deg)}}
  @keyframes slideIn{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
  @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  @supports(padding:env(safe-area-inset-bottom)){.safe-bottom{padding-bottom:calc(20px + env(safe-area-inset-bottom))}}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script>
"use strict";
var ce=React.createElement;
var useState=React.useState,useEffect=React.useEffect,useRef=React.useRef,useMemo=React.useMemo,useCallback=React.useCallback;

var SLOT_PRIORITY={"evening":0,"18:00":0,"afternoon":1,"13:00":1,"morning":2,"07:00":2};
function slotScore(l){l=(l||"").toLowerCase();for(var k in SLOT_PRIORITY)if(l.indexOf(k)!==-1)return SLOT_PRIORITY[k];return 5;}

function fetchNewsJSON(){
  return fetch("news.json?t="+Date.now()+"&r="+Math.random(),{cache:"no-store"})
    .then(function(r){if(!r.ok)throw new Error(r.status);return r.json();})
    .catch(function(e){console.warn("news.json:",e);return null;});
}

function T(d){
  return d?{
    bg:"linear-gradient(160deg,#0e0e16 0%,#131320 35%,#0f1520 100%)",
    sf:"rgba(255,255,255,0.04)",sfH:"rgba(255,255,255,0.08)",
    gl:"rgba(255,255,255,0.06)",glB:"rgba(255,255,255,0.12)",
    tx:"#f0f0f5",tx2:"rgba(255,255,255,0.60)",tx3:"rgba(255,255,255,0.38)",
    ac:"#7ec4ff",acS:"rgba(126,196,255,0.12)",acB:"rgba(126,196,255,0.22)",
    tg:"rgba(126,196,255,0.10)",tgT:"#8acaff",
    dv:"rgba(255,255,255,0.08)",
    sh:"0 1px 3px rgba(0,0,0,0.18),0 8px 32px rgba(0,0,0,0.22)",
    sB:"rgba(255,255,255,0.07)",
    pA:"rgba(255,255,255,0.12)",pAB:"rgba(255,255,255,0.22)",
    xB:"rgba(255,255,255,0.10)",xT:"#e0e0e0",
    hBg:"rgba(14,14,22,0.82)",pu:"#b49bff",
    cardBg:"rgba(255,255,255,0.05)",
  }:{
    bg:"linear-gradient(160deg,#f8f8fc 0%,#f0f1f8 35%,#f4f6fa 100%)",
    sf:"rgba(0,0,0,0.015)",sfH:"rgba(0,0,0,0.035)",
    gl:"rgba(255,255,255,0.80)",glB:"rgba(0,0,0,0.06)",
    tx:"#1a1a2e",tx2:"rgba(0,0,0,0.46)",tx3:"rgba(0,0,0,0.20)",
    ac:"#2563eb",acS:"rgba(37,99,235,0.07)",acB:"rgba(37,99,235,0.18)",
    tg:"rgba(37,99,235,0.06)",tgT:"#2563eb",
    dv:"rgba(0,0,0,0.055)",
    sh:"0 1px 3px rgba(0,0,0,0.04),0 8px 32px rgba(0,0,0,0.05)",
    sB:"rgba(0,0,0,0.03)",
    pA:"rgba(37,99,235,0.08)",pAB:"rgba(37,99,235,0.18)",
    xB:"rgba(0,0,0,0.04)",xT:"#1a1a2e",
    hBg:"rgba(248,248,252,0.82)",pu:"#7c3aed",
    cardBg:"rgba(255,255,255,0.75)",
  };
}

function SourceIcon(p){
  var a=p.a,t=p.t,sz=p.sz||18;
  return ce("div",{style:{width:sz,height:sz,borderRadius:sz>24?10:sz>18?7:5,
    background:a.isFromX?"linear-gradient(135deg,#444,#666)":"linear-gradient(135deg,"+t.ac+","+t.pu+")",
    display:"flex",alignItems:"center",justifyContent:"center",
    fontSize:a.isFromX?(sz>24?16:sz>18?11:10):(sz>24?13:sz>18?10:9),
    fontWeight:700,color:"#fff",flexShrink:0,
    boxShadow:sz>24?"0 2px 8px "+t.ac+"30":"none",
  }},a.isFromX?"\ud835\udd4f":(a.source||"?")[0]);
}

function Btn(p){
  return ce("button",{onClick:p.onClick,style:Object.assign({
    width:38,height:38,borderRadius:12,
    background:p.t.gl,border:"1px solid "+p.t.glB,color:p.t.tx2,fontSize:16,cursor:"pointer",
    display:"flex",alignItems:"center",justifyContent:"center",
    transition:"all 0.25s cubic-bezier(.4,0,.2,1)",
    backdropFilter:"blur(24px)",WebkitBackdropFilter:"blur(24px)",
  },p.s||{})},p.children);
}

function NewsCard(p){
  var a=p.a,t=p.t,ref=useRef(null);
  var starred=p.isExplored&&p.isExplored(a.id);
  return ce("div",{ref:ref,onClick:function(){p.onSelect(a);},
    onMouseEnter:function(){if(ref.current){ref.current.style.background=t.sfH;ref.current.style.transform="scale(1.005)";}},
    onMouseLeave:function(){if(ref.current){ref.current.style.background="transparent";ref.current.style.transform="scale(1)";}},
    style:{padding:"18px 20px",cursor:"pointer",borderBottom:p.last?"none":"1px solid "+t.dv,
      transition:"all 0.2s cubic-bezier(.4,0,.2,1)",transformOrigin:"center"}},
    ce("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:9}},
      ce("div",{style:{flex:1,display:"flex",flexWrap:"wrap",gap:6,alignItems:"center"}},
        ce("button",{onClick:function(e){e.stopPropagation();p.onToggleExplore(a.id);},
          style:{background:"none",border:"none",cursor:"pointer",padding:0,display:"flex",alignItems:"center",
            transition:"all 0.2s",flexShrink:0,opacity:starred?1:0.35,
          }},
          ce("svg",{width:14,height:14,viewBox:"0 0 24 24",fill:starred?"#f59e0b":"none",
            stroke:starred?"#f59e0b":"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",
            style:{color:t.tx3}},
            ce("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})
          )
        ),
        a.isFromX&&ce("span",{style:{fontSize:9,fontWeight:700,padding:"3px 8px",borderRadius:100,background:t.xB,color:t.xT,letterSpacing:"0.5px"}},"\ud835\udd4f"),
        (a.tags||[]).map(function(tag){return ce("span",{key:tag,style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.8px",color:t.tgT}},tag);})
      ),
      ce("span",{style:{fontSize:11,color:t.tx3,flexShrink:0,opacity:0.7}},a.readTime)
    ),
    ce("h3",{style:{fontFamily:"'Newsreader',Georgia,serif",fontSize:17.5,fontWeight:500,lineHeight:1.38,marginBottom:9,letterSpacing:"-0.3px",color:t.tx}},a.headline),
    ce("p",{style:{fontSize:13.5,lineHeight:1.6,color:t.tx2,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"}},a.summary),
    ce("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:12}},
      ce(SourceIcon,{a:a,t:t}),
      ce("span",{style:{fontSize:12,color:t.tx3}},a.source),
      a.postedAt&&ce("span",{style:{fontSize:11,color:t.tx3,opacity:0.6}}," \xb7 "+a.postedAt)
    )
  );
}

function ArticleView(p){
  var a=p.a,t=p.t;
  var starred=p.isExplored&&p.isExplored(a.id);
  return ce("div",{style:{minHeight:"100dvh",background:t.bg,color:t.tx}},
    ce("div",{style:{position:"sticky",top:0,zIndex:100,backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)",background:t.hBg,borderBottom:"1px solid "+t.dv}},
      ce("div",{style:{maxWidth:680,margin:"0 auto",padding:"14px 20px",display:"flex",alignItems:"center",gap:12}},
        ce("button",{onClick:p.onBack,style:{background:t.gl,border:"1px solid "+t.glB,borderRadius:12,padding:"9px 16px",color:t.ac,fontSize:14,cursor:"pointer",fontWeight:500,display:"flex",alignItems:"center",gap:6,backdropFilter:"blur(20px)",transition:"all 0.2s"}},
          ce("span",{style:{fontSize:18,lineHeight:1}},"\u2039")," Back"),
        ce("div",{style:{flex:1}}),
        ce("button",{onClick:function(){p.onToggleExplore(a.id);},
          style:{background:starred?"rgba(245,158,11,0.10)":"none",border:starred?"1px solid rgba(245,158,11,0.25)":"1px solid "+t.glB,
            borderRadius:12,padding:"8px 14px",cursor:"pointer",
            display:"flex",alignItems:"center",gap:6,
            transition:"all 0.2s",backdropFilter:"blur(20px)"}},
          ce("svg",{width:15,height:15,viewBox:"0 0 24 24",fill:starred?"#f59e0b":"none",
            stroke:starred?"#f59e0b":"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",
            style:{color:t.tx3}},
            ce("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})
          ),
          ce("span",{style:{fontSize:12,fontWeight:500,color:starred?"#f59e0b":t.tx3}},starred?"Saved":"Save")
        ),
        a.isFromX&&ce("span",{style:{fontSize:11,fontWeight:600,padding:"4px 10px",borderRadius:100,background:t.xB,color:t.xT}},"from \ud835\udd4f"),
        ce("span",{style:{fontSize:11,color:t.tx3,letterSpacing:"0.5px",textTransform:"uppercase"}},a.readTime)
      )
    ),
    ce("div",{style:{maxWidth:680,margin:"0 auto",padding:"36px 20px 80px",animation:"fadeUp 0.4s cubic-bezier(.4,0,.2,1) both"}},
      ce("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginBottom:20}},
        (a.tags||[]).map(function(tag){return ce("span",{key:tag,style:{fontSize:11,fontWeight:600,textTransform:"uppercase",letterSpacing:"1px",color:t.tgT,background:t.tg,padding:"6px 14px",borderRadius:100}},tag);})
      ),
      ce("h1",{style:{fontFamily:"'Newsreader',Georgia,serif",fontSize:"clamp(26px,6vw,36px)",fontWeight:400,lineHeight:1.22,marginBottom:22,letterSpacing:"-0.5px"}},a.headline),
      ce("div",{style:{display:"flex",alignItems:"center",gap:14,marginBottom:36,paddingBottom:24,borderBottom:"1px solid "+t.dv}},
        ce(SourceIcon,{a:a,t:t,sz:38}),
        ce("div",null,
          ce("div",{style:{fontSize:14.5,fontWeight:500}},a.source),
          ce("div",{style:{fontSize:12,color:t.tx2,marginTop:2}},
            p.fmtDate(a.date)+" \xb7 "+a.time+(a.postedAt?" \xb7 Posted "+a.postedAt:""))
        )
      ),
      ce("div",{style:{fontFamily:"'Newsreader',Georgia,serif",fontSize:18.5,lineHeight:1.78,color:p.dark?"rgba(255,255,255,0.85)":"rgba(0,0,0,0.70)"}},
        ce("p",{style:{marginBottom:24,fontSize:19,fontWeight:500,lineHeight:1.6}},a.summary),
        (a.description&&a.description!==a.summary)&&ce("p",{style:{marginBottom:24}},a.description)
      ),
      a.link&&ce("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",style:{
        display:"inline-flex",alignItems:"center",gap:8,padding:"14px 28px",borderRadius:14,marginTop:16,
        background:t.acS,color:t.ac,fontSize:15,fontWeight:500,
        textDecoration:"none",border:"1px solid "+t.acB,
        transition:"all 0.25s cubic-bezier(.4,0,.2,1)",
      }},a.isFromX?"View post on \ud835\udd4f \u2197":"Read full article \u2197")
    )
  );
}

function App(){
  var _dm=useState(true),dark=_dm[0],setDark=_dm[1];
  var _news=useState([]),allNews=_news[0],setAllNews=_news[1];
  var _sd=useState(null),selDate=_sd[0],setSelDate=_sd[1];
  var _sq=useState(""),query=_sq[0],setQuery=_sq[1];
  var _sa=useState(null),selArt=_sa[0],setSelArt=_sa[1];
  var _ss=useState(false),showSrch=_ss[0],setShowSrch=_ss[1];
  var _nu=useState(""),nextUp=_nu[0],setNextUp=_nu[1];
  var _ld=useState(true),loading=_ld[0],setLoading=_ld[1];
  var _err=useState(false),hasError=_err[0],setHasError=_err[1];
  var _ref=useState(0),refreshCount=_ref[0],setRefreshCount=_ref[1];
  var _lc=useState(""),lastChecked=_lc[0],setLastChecked=_lc[1];
  var _toast=useState(""),toast=_toast[0],setToast=_toast[1];
  var _selTag=useState(null),selTag=_selTag[0],setSelTag=_selTag[1];
  var sRef=useRef(null);
  var scrollPosRef=useRef(0);
  var prevCountRef=useRef(0);
  // Pull-to-refresh
  var _pull=useState(0),pullDist=_pull[0],setPullDist=_pull[1];
  var _pulling=useState(false),isPulling=_pulling[0],setIsPulling=_pulling[1];
  var pullStartY=useRef(0);
  var pullActive=useRef(false);
  var PULL_THRESHOLD=80;

  // Explore list â€” persisted in localStorage
  var _showEx=useState(false),showExplore=_showEx[0],setShowExplore=_showEx[1];
  function loadExplore(){
    try{var s=localStorage.getItem("ai-pulse-explore");return s?JSON.parse(s):[];}
    catch(e){return[];}
  }
  function saveExplore(arr){
    try{localStorage.setItem("ai-pulse-explore",JSON.stringify(arr));}catch(e){}
  }
  var _exIds=useState(loadExplore),exploreIds=_exIds[0],setExploreIds=_exIds[1];
  function toggleExplore(id){
    setExploreIds(function(prev){
      var next=prev.indexOf(id)===-1?prev.concat([id]):prev.filter(function(x){return x!==id;});
      saveExplore(next);
      return next;
    });
  }
  function isExplored(id){return exploreIds.indexOf(id)!==-1;}

  function cleanText(s){
    if(!s)return s;
    s=s.replace(/&#(\d+);/g,function(_,n){return String.fromCharCode(parseInt(n,10));});
    s=s.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&nbsp;/g," ");
    s=s.replace(/\[\s*\.\.\.\s*\]/g,"...").replace(/\[\s*\u2026\s*\]/g,"...");
    return s.trim();
  }
  function cleanArticle(a){
    return Object.assign({},a,{headline:cleanText(a.headline),summary:cleanText(a.summary),description:cleanText(a.description)});
  }

  var loadNews=useCallback(function(manual){
    setLoading(true);
    if(manual)setToast("");
    fetchNewsJSON().then(function(data){
      if(data&&Array.isArray(data)&&data.length>0){
        var oldCount=prevCountRef.current;
        var cleaned=data.map(cleanArticle);
        setAllNews(cleaned);
        prevCountRef.current=cleaned.length;
        setHasError(false);
        var now=new Date();var h=now.getHours();var m=now.getMinutes();
        setLastChecked((h<10?"0":"")+h+":"+(m<10?"0":"")+m);
        if(manual){
          var diff=data.length-oldCount;
          if(diff>0){setToast(diff+" new article"+(diff>1?"s":"")+" found!");}
          else{setToast("You\u2019re up to date!");}
          setTimeout(function(){setToast("");},3000);
        }
      }else{
        setHasError(true);
        if(manual){setToast("Could not refresh");setTimeout(function(){setToast("");},3000);}
      }
      setLoading(false);
    });
  },[]);

  useEffect(function(){loadNews();},[loadNews]);
  useEffect(function(){var i=setInterval(loadNews,10*60*1000);return function(){clearInterval(i);};},[loadNews]);

  useEffect(function(){
    var calc=function(){
      var now=new Date();var cetH=(now.getUTCHours()+1)%24;
      var slots=[7,13,18];var next=null;
      for(var i=0;i<slots.length;i++){if(slots[i]>cetH){next=slots[i];break;}}
      if(next===null)next=slots[0];
      var diff=next>cetH?next-cetH:24-cetH+next;
      var mins=60-now.getUTCMinutes();
      setNextUp((diff>1?diff-1:0)+"h "+mins+"m");
    };
    calc();var i=setInterval(calc,60000);return function(){clearInterval(i);};
  },[]);

  useEffect(function(){
    document.querySelector('meta[name="theme-color"]')?.setAttribute("content",dark?"#0e0e16":"#f8f8fc");
  },[dark]);
  useEffect(function(){if(showSrch&&sRef.current)sRef.current.focus();},[showSrch]);

  // Pull-to-refresh touch handlers
  useEffect(function(){
    var onStart=function(e){
      if(window.scrollY<=0){
        pullStartY.current=e.touches[0].clientY;
        pullActive.current=true;
      }
    };
    var onMove=function(e){
      if(!pullActive.current)return;
      var dy=e.touches[0].clientY-pullStartY.current;
      if(dy>0){
        setPullDist(Math.min(dy*0.5,120));
        if(dy>30)e.preventDefault();
      }else{
        pullActive.current=false;
        setPullDist(0);
      }
    };
    var onEnd=function(){
      if(pullActive.current&&pullDist>=PULL_THRESHOLD){
        setIsPulling(true);
        loadNews(true);
        setTimeout(function(){setIsPulling(false);},1200);
      }
      pullActive.current=false;
      setPullDist(0);
    };
    document.addEventListener("touchstart",onStart,{passive:true});
    document.addEventListener("touchmove",onMove,{passive:false});
    document.addEventListener("touchend",onEnd,{passive:true});
    return function(){
      document.removeEventListener("touchstart",onStart);
      document.removeEventListener("touchmove",onMove);
      document.removeEventListener("touchend",onEnd);
    };
  },[pullDist,loadNews]);

  // Fixed 7-day pill bar: Today, Yesterday, + 5 more days (always shown)
  var pillDates=useMemo(function(){
    var arr=[];
    var now=new Date();
    for(var i=0;i<7;i++){
      var d=new Date(now);d.setDate(d.getDate()-i);
      arr.push(d.toISOString().slice(0,10));
    }
    return arr;
  },[]);

  // Trending tags: count occurrences across all articles, pick top 12
  var trendingTags=useMemo(function(){
    var counts={};
    allNews.forEach(function(n){
      (n.tags||[]).forEach(function(tag){counts[tag]=(counts[tag]||0)+1;});
    });
    return Object.keys(counts)
      .map(function(tag){return{tag:tag,count:counts[tag]};})
      .sort(function(a,b){return b.count-a.count;})
      .slice(0,12);
  },[allNews]);

  var filtered=useMemo(function(){
    var items=allNews;
    if(showExplore)items=items.filter(function(n){return exploreIds.indexOf(n.id)!==-1;});
    if(selDate)items=items.filter(function(n){return n.date===selDate;});
    if(selTag)items=items.filter(function(n){return(n.tags||[]).indexOf(selTag)!==-1;});
    if(query.trim()){
      var q=query.toLowerCase();
      items=items.filter(function(n){
        return(n.headline||"").toLowerCase().indexOf(q)!==-1||(n.summary||"").toLowerCase().indexOf(q)!==-1||(n.tags||[]).some(function(t){return t.toLowerCase().indexOf(q)!==-1;})||(n.source||"").toLowerCase().indexOf(q)!==-1;
      });
    }
    return items;
  },[allNews,selDate,selTag,query,showExplore,exploreIds]);

  // Dates that have articles in the FILTERED set â€” for rendering the feed
  var sortedDates=useMemo(function(){
    var ds=new Set();filtered.forEach(function(n){if(n.date)ds.add(n.date);});
    return Array.from(ds).sort().reverse();
  },[filtered]);

  var grouped=useMemo(function(){
    var g={};
    filtered.forEach(function(n){
      var d=n.date||"unknown";var tm=n.time||"News";
      if(!g[d])g[d]={};if(!g[d][tm])g[d][tm]=[];g[d][tm].push(n);
    });
    return g;
  },[filtered]);

  function getSortedSlots(date){
    if(!grouped[date])return[];
    return Object.keys(grouped[date]).sort(function(a,b){return slotScore(a)-slotScore(b);});
  }

  var fmtDate=function(ds){
    var today=new Date().toISOString().slice(0,10);
    var yest=new Date(Date.now()-86400000).toISOString().slice(0,10);
    if(ds===today)return"Today";if(ds===yest)return"Yesterday";
    return new Date(ds+"T12:00:00").toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"});
  };
  var shortD=function(ds){
    var today=new Date().toISOString().slice(0,10);
    if(ds===today)return"Today";
    var yest=new Date(Date.now()-86400000).toISOString().slice(0,10);
    if(ds===yest)return"Yest.";
    var d=new Date(ds+"T12:00:00");
    var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    return d.toLocaleDateString("en-US",{weekday:"short"})+" "+d.getDate()+" "+months[d.getMonth()];
  };

  var t=T(dark);

  var openArticle=useCallback(function(a){
    scrollPosRef.current=window.scrollY||window.pageYOffset||0;
    setSelArt(a);
  },[]);
  var closeArticle=useCallback(function(){
    setSelArt(null);
    requestAnimationFrame(function(){requestAnimationFrame(function(){window.scrollTo(0,scrollPosRef.current);});});
  },[]);

  if(selArt)return ce(ArticleView,{a:selArt,t:t,dark:dark,fmtDate:fmtDate,onBack:closeArticle,isExplored:isExplored,onToggleExplore:toggleExplore});

  if(loading&&allNews.length===0){
    return ce("div",{style:{minHeight:"100dvh",background:t.bg,color:t.tx,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:32}},
      ce("div",{style:{width:60,height:60,borderRadius:16,background:"linear-gradient(135deg,"+t.ac+","+t.pu+")",display:"flex",alignItems:"center",justifyContent:"center",fontSize:28,marginBottom:24,boxShadow:"0 8px 32px "+t.ac+"40"}},"\u26a1"),
      ce("h1",{style:{fontSize:23,fontWeight:600,marginBottom:8,letterSpacing:"-0.3px"}},"AI Pulse"),
      ce("p",{style:{fontSize:13,color:t.tx2,marginBottom:32}},"Loading latest AI news\u2026"),
      ce("div",{style:{width:42,height:42,border:"3px solid "+t.dv,borderTopColor:t.ac,borderRadius:"50%",animation:"spin 0.8s linear infinite"}})
    );
  }

  if(hasError&&allNews.length===0){
    return ce("div",{style:{minHeight:"100dvh",background:t.bg,color:t.tx,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:32,textAlign:"center"}},
      ce("div",{style:{fontSize:48,marginBottom:20,opacity:0.3}},"\u26a1"),
      ce("h1",{style:{fontSize:22,fontWeight:600,marginBottom:8}},"AI Pulse"),
      ce("p",{style:{fontSize:14,color:t.tx2,marginBottom:24,maxWidth:320}},"Could not load news. Run the workflow in GitHub Actions first."),
      ce("button",{onClick:loadNews,style:{padding:"13px 28px",borderRadius:14,background:t.acS,color:t.ac,border:"1px solid "+t.acB,fontSize:15,fontWeight:500,cursor:"pointer"}},"Try again")
    );
  }

  var pillData=[{l:"All",v:null}].concat(pillDates.map(function(d){return{l:shortD(d),v:d};}));

  return ce("div",{style:{minHeight:"100dvh",background:t.bg,color:t.tx}},
    // Pull-to-refresh indicator
    (pullDist>0||isPulling)&&ce("div",{style:{
      position:"fixed",top:0,left:0,right:0,zIndex:200,
      display:"flex",alignItems:"center",justifyContent:"center",
      height:Math.max(pullDist,isPulling?50:0),
      transition:pullDist>0?"none":"height 0.3s ease",
      overflow:"hidden",
    }},
      ce("div",{style:{
        width:28,height:28,
        border:"3px solid "+t.dv,borderTopColor:t.ac,borderRadius:"50%",
        opacity:pullDist>=PULL_THRESHOLD||isPulling?1:pullDist/PULL_THRESHOLD,
        transform:"rotate("+Math.round(pullDist*3)+"deg)",
        animation:isPulling?"spin 0.8s linear infinite":"none",
      }})
    ),
    // HEADER with animated gradient accent
    ce("div",{style:{position:"sticky",top:0,zIndex:100,overflow:"hidden",borderBottom:"1px solid "+t.dv}},
      // Animated gradient background
      ce("div",{style:{
        position:"absolute",top:0,left:0,right:0,height:3,
        background:dark
          ?"linear-gradient(90deg,#6eb6ff,#a78bfa,#f472b6,#6eb6ff,#a78bfa)"
          :"linear-gradient(90deg,#2563eb,#7c3aed,#ec4899,#2563eb,#7c3aed)",
        backgroundSize:"200% 100%",
        animation:"gradientShift 6s ease infinite",
        opacity:0.85,
      }}),
      ce("div",{style:{backdropFilter:"blur(40px) saturate(200%)",WebkitBackdropFilter:"blur(40px) saturate(200%)",background:t.hBg}},
      ce("div",{style:{maxWidth:720,margin:"0 auto",padding:"16px 20px 0"}},
        // Title row
        ce("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14}},
          ce("div",null,
            ce("h1",{style:{fontSize:22,fontWeight:600,letterSpacing:"-0.3px",display:"flex",alignItems:"center",gap:10}},
              ce("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:10,background:"linear-gradient(135deg,"+t.ac+","+t.pu+")",fontSize:16,boxShadow:"0 4px 16px "+t.ac+"35"}},"\u26a1"),
              "AI Pulse"),
            ce("p",{style:{fontSize:11.5,color:t.tx3,marginTop:3,marginLeft:42,letterSpacing:"0.15px"}},"Your daily AI news briefing, refreshed 3\u00d7 daily")
          ),
          ce("div",{style:{display:"flex",alignItems:"center",gap:7,flexShrink:0}},
            ce(Btn,{t:t,onClick:function(){setRefreshCount(refreshCount+1);loadNews(true);},s:loading?{opacity:0.4}:{}},
              ce("span",{style:loading?{animation:"spin 1s linear infinite",display:"inline-block"}:{}},"â†»")),
            ce(Btn,{t:t,onClick:function(){setShowExplore(!showExplore);if(!showExplore){setSelDate(null);setSelTag(null);}},
              s:showExplore?{background:"rgba(245,158,11,0.12)",borderColor:"rgba(245,158,11,0.3)",color:"#f59e0b"}:{}},
              ce("span",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center"}},
                ce("svg",{width:16,height:16,viewBox:"0 0 24 24",fill:showExplore?"#f59e0b":"none",
                  stroke:showExplore?"#f59e0b":"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},
                  ce("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})
                ),
                exploreIds.length>0&&ce("span",{style:{position:"absolute",top:-7,right:-9,fontSize:8,fontWeight:700,
                  background:"#f59e0b",color:"#000",borderRadius:100,minWidth:14,height:14,
                  display:"flex",alignItems:"center",justifyContent:"center",padding:"0 3px"}},exploreIds.length)
              )
            ),
            ce(Btn,{t:t,onClick:function(){setShowSrch(!showSrch);if(showSrch)setQuery("");},s:showSrch?{background:t.acS,borderColor:t.acB,color:t.ac}:{}},"âŒ•"),
            ce(Btn,{t:t,onClick:function(){setDark(!dark);}},dark?"â˜€":"â˜¾")
          )
        ),
        // Search bar
        showSrch&&ce("div",{style:{marginBottom:12,animation:"slideIn 0.2s ease both"}},
          ce("div",{style:{position:"relative",background:t.sB,borderRadius:14,border:"1px solid "+t.glB,overflow:"hidden"}},
            ce("span",{style:{position:"absolute",left:14,top:"50%",transform:"translateY(-50%)",color:t.tx3,fontSize:15,pointerEvents:"none"}},"âŒ•"),
            ce("input",{ref:sRef,value:query,onChange:function(e){setQuery(e.target.value);},placeholder:"Search headlines, topics, sources\u2026",
              style:{width:"100%",padding:"13px 14px 13px 38px",background:"none",border:"none",outline:"none",color:t.tx,fontSize:15}}),
            query&&ce("button",{onClick:function(){setQuery("");},style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",background:t.sfH,border:"none",width:24,height:24,borderRadius:7,color:t.tx2,fontSize:12,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s"}},"âœ•")
          )
        ),
        // Date pills
        ce("div",{style:{display:"flex",gap:4,overflowX:"auto",paddingBottom:10,paddingLeft:2,WebkitOverflowScrolling:"touch"}},
          pillData.map(function(p){
            var on=p.v===null?selDate===null:selDate===p.v;
            return ce("button",{key:p.l+"|"+(p.v||"all"),onClick:function(){setSelDate(on&&p.v!==null?null:p.v);},
              style:{flexShrink:0,padding:"5px 11px",borderRadius:100,
                background:on?t.pA:"transparent",
                border:"1px solid "+(on?t.pAB:t.dv),
                color:on?t.tx:t.tx2,
                fontSize:12,fontWeight:500,cursor:"pointer",
                transition:"all 0.2s cubic-bezier(.4,0,.2,1)",whiteSpace:"nowrap"}},p.l);
          })
        ),
        // Trending tags row (wraps to max 2 lines)
        trendingTags.length>0&&ce("div",{style:{display:"flex",flexWrap:"wrap",gap:5,paddingBottom:12,paddingLeft:2,maxHeight:68,overflow:"hidden",alignItems:"flex-start"}},
          ce("span",{style:{fontSize:11,color:t.tx3,flexShrink:0,alignSelf:"center",marginRight:2,opacity:0.6}},"\ud83d\udd25"),
          trendingTags.map(function(item){
            var on=selTag===item.tag;
            return ce("button",{key:item.tag,onClick:function(){setSelTag(on?null:item.tag);},
              style:{flexShrink:0,padding:"5px 12px",borderRadius:100,
                background:on?t.tg:"transparent",
                border:"1px solid "+(on?t.tgT+"30":t.dv),
                color:on?t.tgT:t.tx3,
                fontSize:12,fontWeight:500,cursor:"pointer",
                transition:"all 0.2s cubic-bezier(.4,0,.2,1)",whiteSpace:"nowrap",
                display:"flex",alignItems:"center",gap:5,
              }},
              item.tag,
              ce("span",{style:{fontSize:10,opacity:0.5,fontWeight:400}},item.count)
            );
          })
        )
      )
      )
    ),
    // FEED
    ce("div",{style:{maxWidth:720,margin:"0 auto",padding:"6px 16px 60px"},className:"safe-bottom"},
      // Toast
      toast&&ce("div",{style:{
        display:"flex",alignItems:"center",justifyContent:"center",gap:8,
        padding:"11px 20px",margin:"8px 0",borderRadius:14,
        background:t.acS,border:"1px solid "+t.acB,
        animation:"slideIn 0.25s ease both",
        fontSize:13,fontWeight:500,color:t.ac,
      }},toast),
      // Status line
      ce("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8,padding:"14px 0 10px"}},
        ce("span",{style:{width:6,height:6,borderRadius:"50%",background:"#34d399",animation:"pulse 2s ease infinite"}}),
        ce("span",{style:{fontSize:12,color:t.tx3,letterSpacing:"0.2px"}},
          "Next update in "+nextUp+" \xb7 "+filtered.length+(selTag||selDate?" filtered":" stories")+(lastChecked?" \xb7 "+lastChecked:""))
      ),
      // Explore mode banner
      showExplore&&ce("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:10,padding:"10px 16px",margin:"6px 0",
        background:"rgba(245,158,11,0.08)",border:"1px solid rgba(245,158,11,0.2)",borderRadius:14,animation:"slideIn 0.25s ease both"}},
        ce("span",{style:{fontSize:14}},"ðŸ”–"),
        ce("span",{style:{fontSize:13,fontWeight:500,color:"#f59e0b"}},"Explore List"),
        ce("span",{style:{fontSize:12,color:t.tx3}},exploreIds.length+" saved"),
        ce("button",{onClick:function(){setShowExplore(false);},style:{marginLeft:"auto",background:"rgba(245,158,11,0.15)",border:"none",padding:"4px 10px",borderRadius:8,color:"#f59e0b",fontSize:11,cursor:"pointer",fontWeight:500}},"Show all")
      ),
      // Active tag filter indicator
      selTag&&ce("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8,paddingBottom:10}},
        ce("span",{style:{fontSize:12,color:t.tgT}},"Filtered by: "+selTag),
        ce("button",{onClick:function(){setSelTag(null);},style:{background:t.tg,border:"none",padding:"4px 10px",borderRadius:8,color:t.tgT,fontSize:11,cursor:"pointer",fontWeight:500,transition:"all 0.15s"}},"Clear")
      ),
      // Empty state
      sortedDates.length===0&&!loading&&ce("div",{style:{textAlign:"center",padding:"60px 20px",color:t.tx2}},
        ce("div",{style:{fontSize:40,marginBottom:16,opacity:0.3}},showExplore?"ðŸ”–":"âŒ•"),
        ce("div",{style:{fontSize:16,fontWeight:500}},showExplore?"No saved articles yet":"No results found"),
        ce("div",{style:{fontSize:14,marginTop:6,color:t.tx3}},showExplore?"Tap the bookmark icon on any article to save it here":query||selTag?"Try a different filter":"No news yet")
      ),
      // Date groups
      sortedDates.map(function(date){
        var slots=getSortedSlots(date);
        var total=slots.reduce(function(s,sl){return s+(grouped[date][sl]||[]).length;},0);
        return ce("div",{key:date,style:{marginBottom:6}},
          ce("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"22px 4px 12px"}},
            ce("span",{style:{fontSize:15,fontWeight:600,letterSpacing:"-0.2px"}},fmtDate(date)),
            ce("div",{style:{flex:1,height:1,background:t.dv}}),
            ce("span",{style:{fontSize:11,color:t.tx3,letterSpacing:"0.5px"}},total+" stories")
          ),
          slots.map(function(slotLabel){
            var arts=grouped[date][slotLabel];
            return ce("div",{key:slotLabel,style:{marginBottom:14}},
              ce("div",{style:{fontSize:11,fontWeight:600,color:t.ac,letterSpacing:"0.8px",textTransform:"uppercase",padding:"6px 8px 10px",opacity:0.75}},slotLabel),
              ce("div",{style:{
                background:t.cardBg,
                backdropFilter:"blur(30px) saturate(160%)",WebkitBackdropFilter:"blur(30px) saturate(160%)",
                border:"1px solid "+t.glB,borderRadius:22,overflow:"hidden",
                boxShadow:t.sh,transition:"box-shadow 0.3s ease",
              }},
                arts.map(function(a,idx){return ce(NewsCard,{key:a.id||idx,a:a,t:t,last:idx===arts.length-1,onSelect:openArticle,isExplored:isExplored,onToggleExplore:toggleExplore});})
              )
            );
          })
        );
      }),
      // Footer
      ce("div",{style:{textAlign:"center",padding:"32px 0 16px"}},
        ce("div",{style:{fontSize:11,color:t.tx3,letterSpacing:"0.3px"}},"AI Pulse \u2014 Live AI news & \ud835\udd4f posts"),
        ce("div",{style:{fontSize:11,color:t.tx3,marginTop:5,opacity:0.5}},"Updates at 07:00 \xb7 13:00 \xb7 18:00 CET \xb7 Powered by Claude"),
        ce("div",{style:{fontSize:10,color:t.tx3,marginTop:7,opacity:0.3}},"v2.02")
      )
    )
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(ce(App));
</script>
</body>
</html>
